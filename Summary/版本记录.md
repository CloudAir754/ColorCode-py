# 版本记录

远期规划
- 研究两边的问题
- 研究拉伸的情况
- 研究视频流分析的方法
- 视频流解析后的总结返回功能
- 分片上传

## v0.4.3(dev-net)
- [X] 梳理api表单内容
- [ ] 将内存数组移动到sqlite服务器


## v0.4.2 (dev-net) 
- [X] 主要修改Upload的drawio

## v0.4.1 (dev-net)
客户端、服务端联动；
- [X] 基于task_id 轮询获取处理的结果。服务端返回的信息由处理得到，若暂未处理完毕，则返回不成功信息。
若获取成功，则以弹窗展示

## v0.4.0 (dev_net)
该小版本主要解决上传下载问题
【简单的数据陈列==> 5s视频，视频15M，图片77M，传3s（外网好网），处理3s】
必须要分片（太大了），按照30s延迟的话，一个分片用20M比较保守
- [X] 按照20m为分片进行上传，每次上传完则进行保存，服务端接收完视频直接返回200的确认。
- 为防止超时，应当限制同时上传的分片数量。当前批次上传完成后，才开始下一批次的上传
- [X] 服务端暂时只进行视频的整合工作。即将多个分片按照原始顺序整合为一个视频。
- [X] 客户端上传视频完成后，服务器立即返回一个任务ID。这个ID作为后期取视频分析结果的路径


## v0.3.5
- [X] 修改color_detection 

## v0.3.4 
- [X] 根据绿色定位对角线的三个方块
- [X] 根据对角线的三个方块(左右上下界限)定位其他色块，注意，有可能有偏位和少色问题

## v0.3.3 
忘记走dev分支了呜呜呜
- [A] 增加按照颜色找对角线的方法，将对角线的色块计入一个单独的数组

## v0.3.2
- [X] 实际整理代码；删去无用代码；微调无需参数
- [X] 按照流程梳理代码流


## v0.3.1
- [X] 梳理新需求下的程序数据流【到 程序运行框图.drawio】

## v0.3.0
-[X]仔细合并代码
-[X]整理20250331 新需求


## v0.2.7 
-[X] 合并后端Flask代码；展示所有冲突，在下一个大版本中，将会依据20250331会议，删去无关内容。

## v0.2.6
这个版本之后，考虑合并Flask后端代码。在 `v0.3.z` 进行衔接
-[X]提取主函数，将类完全独立为一个单独的类

## v0.2.5
2025/03/31 更新部分识别素材；配合安卓端，将长宽比改为16：9（高9，宽16）
-[X]16:9
-[X]最新样本
-[X] 这一套新样本，亮度高==》衬料边缘难以去除、无磷光情况无法输出Black

## v0.2.4
需要要求摄制的时候，就几乎指向材料。这样才能通过亮度就行判定
-[X] 也许亮度侦测逻辑，需要结合整体亮度来判断！
-[X] 捋清楚视频逻辑，再调优输出输入接口



## v0.2.3
- `v0.2.2` 已经基本上满足识别需求；需要做的主要是参数调优
-[X] 调整颜色分类器；为颜色识别的debug窗口加黑边；
-[X] 抽取颜色检测部分的超参数；


## v0.2.2
-[X] 导入定位点标签相关概念
-[X] 整理由于定位点造成的代码混乱；记录到drawio


## v0.2.1
-[X] 更改图像为4:3（高3横向4）；调整内参数为对应【用于方便收集来自摄像头的信息】
-[X] 导入亮度概念；计算前20%亮度信息；且能检测亮度不对后跳出程序



## v0.2.0
整理为一个分块的程序；删去基于新建文件的版本管理办法（趋于完善）

## v0.1.3
- 整合上一版本有优势的地方
- 透视矫正原理，不考虑使用==>（定四个点，然后把这四个点拉成一个正方形）
- 重点解决问题仨：
1. 边缘检测有时不能很好的闭合（当有大框的时候需要细节处理）；
2. 【已移除】透视矫正最好移除；
3. 【以实现】颜色识别未使用边缘检测框出的色块

### test14_package
- [X]整理拆分后的逻辑
0. 传参只穿`self`；除`analyze`外，都不返回值。
1. `color_code_detector.py` 主程序，只含有`init`初始化过程与`analyze`分析调用过程
2. `visualize_part.py` 可视化图片，两个函数用于 =1= 展示图片 =2= 可视化边缘和颜色检测
3. `color_detection.py` 检测色块区域和颜色代码
4. `detect_radio.py` 探测拉伸比率，依赖`self.contours_ordered`（排好序的外接四边形点集）
    计算长宽比，进行统计学分析（均值+偏离均值告警）
5. `contour_detection.py` 边缘检测、筛选、排序
6. `image_preprocessing.py` 初步调整图像：大小、亮度、灰度、形态学增强、闭运算


### test13_package
- [X]将test13 拆分为多个子模块
1. 未重新梳理逻辑

### test12
1. 改hsv的识别映射；删去rgb的识别（代码太长了）
2. 提取HSV 边界值【这个不错，直接观测H通道即可有很好的颜色区分】
3. 增加`hsv调色盘.py`，一个观察hsv颜色的小工具
4. 当前版本能较好的实现针对`Pic2-2.jpg`的识别；下一个痛点是如何剔除无效框（即大框）

### test11
1. 添加新功能，识别拉伸
2. 添加颜色指数映射；增加对比度，不错
- 下一个要改动的地方
1. 改颜色识别模块（准确边界值）
2. 或者引入deepseek，进行识别


### 整合v0.1.2
1. 这个就是用来整合`v0.1.2`的七个文件进行整合
2. 将基本程序梳理了程序的运行逻辑，绘制程序运行图到`./Summary/程序运行框图.drawio`
3. 整个程序有如下流程：读图、改大小、形态学增强；
取轮廓、闭运算；筛选轮廓，提取内接；
排序内接点，实现有序输出
根据内接提取对应框的颜色；识别颜色导出
- 有问题的地方：
1. 颜色识别还是不够宽泛（考虑引入deepseek进行处理）
2. `morphologyEx`函数的闭合问题
3. 【功能从0增加】拉伸信息检测
4. 尝试引入直方图均衡化=test02
5. 增加指数映射，增加对比度

## v0.1.2
- 简单整理项目文件夹，重命名素材
- 理清DS开发内容，删去部分无用代码
- 全部该版本的内容归入`/DS-2025/v0.1.2`目录
- 重点问题仨：
1. 边缘检测有时不能很好的闭合（当有大框的时候需要细节处理）；
2. 透视矫正最好移除；
3. 颜色识别未使用边缘检测框出的色块

### test7
0. 这个版本同test6；仅仅可视化了取色区块


### test6
0. 这个版本跳过了颜色映射问题，直接显示rgb值；无透视变换
1. 对颜色判定方式，改成井的中间小区域的均值【仍然不是预期的方式】，且将颜色标注在图片上
2. 问题1：井+RGB
3. 亮点1：在图片上标注颜色
4. 亮点2：在区域中间取色
5. 亮点3：放弃了透视变换


###  test5
0. 与test4差别不大
1. 问题1：颜色突然改到RGB，这个不好吧；颜色处理依旧按照（井）字

###  test4
0. 整体上，感觉应该还是透视变换后，情况不好
1. 问题1：分析颜色，还是【井】


###  test3
0. 整体上，Warped output（扭曲的）无图，（总不能又是test01 的同款bug吧……）；识别结论是all black ；还有一个莫名其妙的图
1. 预处理：同test02；查找轮廓、过滤轮廓 同test02
2. 透视变化：感觉还是有问题【写新版本的时候，需要重新研究透视问题（或跳过这个需求）】（shift+alt+↓，可以复制当前行）
3. 检测颜色：依然是粗暴分割原始图像（use 井）
4. 问题1：透视变换几乎不可用
5. 问题2：颜色检测仍然是粗暴分割图像


### test2 （第二版）
0. 整体上，会一次性可视化多个流程；
1. 预处理：缩放（有问题），灰度化，直方图均衡【这个还不错】，边缘检测（不够，依赖超参数），形态学闭合操作；
2. 查找候选、选择最佳：逻辑与test1一致、但是由于预处理效果不佳，此处效果不好
3. 问题1：边缘检测效果不佳 ，不能搜到边缘；去除了HSV这一不错的改进
4. 问题2：功能需求被弱化【无颜色处理、拉伸信息？？？？？？】
4. 亮点1：引入直方图均衡，潜在增加对比对

### test1（DS辅助-第一版）
0. 整体上，代码逻辑没有太大问题，从原来的面向过程的编写方式，引入面向对象的编写方式；
1. 问题1：有很多参数没有提取出来（没放到init阶段，不利于后期灵活调参）；
2. 问题2：畸形矫正相关函数（`order_points`和`perspective_transform`）的四个点相对位置有问题；
3. 问题3：接着问题2，这四个点导致的矫正，会导致图片只看到原图片的一个角落；
4. 问题4：`morphologyEx`函数，某些时候难以让边缘闭合，还要考虑合理的方式，让这个闭合成功；
5. 问题5：颜色管理过程，居然放弃了之前求边缘的结果，粗暴对图片放一个“井”字；
6. 亮点1：引入类，在init过程有利于对诸多参数进行初始化；
7. 亮点2：引入HSV色彩体系，从理论上能够增加色彩分析的鲁棒性；
8. 亮点3：引入`approxPolyDP`多边形逼近，创新型筛选合理边框


## v0.1.1
2024年完成的python开发内容，补充部分基于DS的识别提高（在DS-2025文件夹）。

这个版本，ds的内容还不能很好的识别。甚至部分代码逻辑有混乱问题


